{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/tfm_torrent_highlighter.user.js"],"names":["TFMTorrentHighlighter","_debug","TorrentPropertyParser","linkElement","delimiter","delim","spanTemplate","document","createElement","className","docFrag","createDocumentFragment","console","log","textContent","fields","index","handlers","nodeAppended","state","GlobalStates","INITIALISE","func","GlobalHandlers","call","e","error","length","FINISHED","INSERT_DOCFRAG","content","key","value","dataset","span","cloneNode","nodeType","appendChild","newSpan","text","createTextNode","hasChildNodes","removeChild","lastChild","newCaptureHandler","nextState","appendDelim","appendSpan","peekNext","newFlagHandler","stateIfFalse","__flagHandler","field","newListHandler","values","indexOf","Object","freeze","DETECTING","BEGIN","COMMON_TRAILING_FIELDS","ERROR","MusicStates","ENCODING","BITRATE","SOURCE","LOG","CUE","MusicHandlers","AnimeStates","CONTAINER","ASPECT_RATIO","VIDEO_CODEC","RESOLUTION","AUDIO_CODEC_AND_CHANNELS","DUAL_AUDIO","SUBBING_AND_GROUP","REMASTER","TRAILING_FIELDS","AnimeHandlers","getNext","charAt","left","substr","right","slice","appendText","AUDIO_CODEC","codec","lastIndexOf","channels","node","tagName","alt","SUBBING","simpleSubbingHandler","trim","groupString","endsWith","GameStates","TYPE","PLATFORM","REGION","ARCHIVED","SCENE","GameHandlers","BookStates","TRANSLATION","FORMAT","ONGOING","BookHandlers","translation","group","replace","FirstFields","oldNodes","childNodes","i","child","Node","TEXT_NODE","nodeValue","str","splitArray","split","j","push","childElementCount","lastText","f","handler","undefined","info","clearChildren","n","COMMON_TRAILING","ELEMENT_NODE","toUpperCase","src","torrentPageTorrents","querySelectorAll","p","t","link","firstChild","trimLeft","hasArrow","prefix","classList","add","href","parse","searchResultTorrents","bbcodeTorrents","textNode","torrents1","bbcodeString","yearIndex","leftDocFrag","leftString","year","dashIndex","artist","album","splitText","insertBefore"],"mappings":"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","file":"tfm_torrent_highlighter.user.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// ==UserScript==\r\n// @name         TFM's torrent highlighter\r\n// @namespace    TheFallingMan\r\n// @version      0.1.1\r\n// @description  Adds attributes to torrent links, allowing CSS styling.\r\n// @author       TheFallingMan\r\n// @icon         https://animebytes.tv/favicon.ico\r\n// @match        https://animebytes.tv/*\r\n// @license      GPL-3.0\r\n// ==/UserScript==\r\n\r\n\r\n(function TFMTorrentHighlighter() {\r\n    function _debug() { return false; }\r\n\r\n    class TorrentPropertyParser {\r\n\r\n        constructor(linkElement, delimiter) {\r\n            this.linkElement = linkElement;\r\n            this.delim = delimiter;\r\n            this.spanTemplate = document.createElement('span');\r\n            this.spanTemplate.className = 'userscript-highlight torrent-field';\r\n            this.docFrag = document.createDocumentFragment();\r\n        }\r\n\r\n        parse() {\r\n            _debug() && console.log(this.linkElement.textContent);\r\n            this.fields = [];\r\n            this.index = 0;\r\n            this.handlers = {};\r\n            this.nodeAppended = false;\r\n\r\n            let state = GlobalStates.INITIALISE;\r\n            let func;\r\n            while (state) {\r\n                func = this.handlers[state];\r\n                if (!func)\r\n                    func = GlobalHandlers[state];\r\n\r\n                try {\r\n                    state = func.call(this);\r\n                } catch (e) {\r\n                    console.error(e);\r\n                    _debug() && console.log(this.linkElement);\r\n                    _debug() && console.log(this.index);\r\n                    _debug() && console.log(this.fields);\r\n                    _debug() && console.log(state);\r\n                    throw e;\r\n                }\r\n                if (this.index >= this.fields.length) {\r\n                    if (state !== GlobalStates.FINISHED) {\r\n                        state = GlobalHandlers[GlobalStates.INSERT_DOCFRAG].call(this);\r\n                    }\r\n                }\r\n            }\r\n\r\n\r\n            _debug() && console.log(state);\r\n            _debug() && console.log(this.docFrag);\r\n            _debug() && console.log(this.docFrag);\r\n        }\r\n\r\n        getNext() {\r\n            return this.fields[this.index++];\r\n        }\r\n\r\n        peekNext() {\r\n            return this.fields[this.index];\r\n        }\r\n\r\n        newSpan(content, key, value) {\r\n            this.linkElement.dataset[key] = value;\r\n\r\n            let span = this.spanTemplate.cloneNode(false);\r\n\r\n            span.dataset[key] = value;\r\n            if (content.nodeType) {\r\n                this.nodeAppended = true;\r\n                span.appendChild(content);\r\n            } else {\r\n                span.textContent = content;\r\n            }\r\n            return span;\r\n        }\r\n\r\n        appendSpan(content, key, value) {\r\n            this.docFrag.appendChild(\r\n                this.newSpan(content, key, value));\r\n        }\r\n\r\n        appendText(text) {\r\n            this.docFrag.appendChild(document.createTextNode(text));\r\n        }\r\n\r\n        appendDelim() {\r\n            this.docFrag.appendChild(document.createTextNode(this.delim));\r\n        }\r\n\r\n        clearChildren() {\r\n            while (this.linkElement.hasChildNodes()) {\r\n                this.linkElement.removeChild(this.linkElement.lastChild);\r\n            }\r\n        }\r\n    }\r\n\r\n    function newCaptureHandler(key, nextState, delim=true) {\r\n        return function () {\r\n            if (delim)\r\n                this.appendDelim();\r\n            this.appendSpan(this.peekNext(), key, this.peekNext());\r\n            this.index++;\r\n            return nextState;\r\n        };\r\n    }\r\n\r\n    function newFlagHandler(value, key, nextState, stateIfFalse=null) {\r\n        return function __flagHandler() {\r\n            let field = this.peekNext();\r\n            if (value === field) {\r\n                this.index++;\r\n                this.appendDelim();\r\n                this.appendSpan(field, key, '');\r\n            } else {\r\n                if (stateIfFalse !== null) {\r\n                    return stateIfFalse;\r\n                }\r\n            }\r\n            return nextState;\r\n        };\r\n    }\r\n\r\n    function newListHandler(values, key, nextState, stateIfFalse=null) {\r\n        return function __flagHandler() {\r\n            let field = this.peekNext();\r\n            if (values.indexOf(field) !== -1) {\r\n                this.index++;\r\n                this.appendDelim();\r\n                this.appendSpan(field, key, field);\r\n            } else if (stateIfFalse !== null) {\r\n                return stateIfFalse;\r\n            }\r\n            return nextState;\r\n        };\r\n    }\r\n\r\n    const GlobalStates = Object.freeze({\r\n        INITIALISE: -11,\r\n        DETECTING: -1,\r\n        BEGIN: -2,\r\n        COMMON_TRAILING_FIELDS: -3, // FL, exclusive, snatched, hentai, etc.\r\n        INSERT_DOCFRAG: -5,\r\n        FINISHED: false,\r\n        ERROR: -10,\r\n    });\r\n\r\n    const MusicStates = Object.freeze({\r\n        ENCODING: 1,\r\n        BITRATE: 2,\r\n        SOURCE: 3,\r\n        LOG: 4,\r\n        CUE: 5\r\n    });\r\n    /**\r\n     * @function\r\n     * @typedef {() => number} transitionHandler\r\n     * @param {TorrentPropertyParser} this\r\n     */\r\n    null;\r\n\r\n    let MusicHandlers = ({\r\n        [GlobalStates.BEGIN]: newCaptureHandler('encoding', MusicStates.BITRATE, false),\r\n        [MusicStates.BITRATE]: newCaptureHandler('bitrate', MusicStates.SOURCE),\r\n        [MusicStates.SOURCE]: newCaptureHandler('source', MusicStates.LOG),\r\n        [MusicStates.LOG]: newFlagHandler('Log', 'log', MusicStates.CUE),\r\n        [MusicStates.CUE]: newFlagHandler('Cue', 'cue', GlobalStates.COMMON_TRAILING_FIELDS)\r\n    });\r\n\r\n    const AnimeStates = Object.freeze({\r\n        SOURCE: 1,\r\n        CONTAINER: 2,\r\n        ASPECT_RATIO: 3,\r\n        VIDEO_CODEC: 4,\r\n        RESOLUTION: 5,\r\n        AUDIO_CODEC_AND_CHANNELS: 6,\r\n        DUAL_AUDIO: 7,\r\n        SUBBING_AND_GROUP: 8,\r\n        REMASTER: 9,\r\n        TRAILING_FIELDS: 10\r\n    });\r\n\r\n    /**\r\n     * @type {Object<number, transitionHandler>}\r\n     */\r\n    let AnimeHandlers = ({\r\n        [GlobalStates.BEGIN]: newCaptureHandler('source', AnimeStates.CONTAINER, false),\r\n        [AnimeStates.CONTAINER]: function CONTAINER() {\r\n            let field = this.getNext();\r\n            if (field.charAt(field.length-1) === ')') {\r\n                let left = field.substr(0, field.indexOf(' ('));\r\n                let right = field.slice(field.indexOf(' (')+2, -1);\r\n                this.appendDelim();\r\n                this.appendSpan(left, 'container', left);\r\n                this.appendText(' (');\r\n                this.appendSpan(right, 'region', right);\r\n                this.appendText(')');\r\n                return AnimeStates.ASPECT_RATIO;\r\n            } else {\r\n                this.appendDelim();\r\n                this.appendSpan(field, 'container', field);\r\n                return AnimeStates.VIDEO_CODEC;\r\n            }\r\n        },\r\n        [AnimeStates.ASPECT_RATIO]: function ASPECT_RATIO() {\r\n            let field = this.getNext();\r\n            this.appendDelim();\r\n            this.appendSpan(field, 'aspectRatio', field);\r\n            if (this.fields[0] === 'DVD5' || this.fields[0] === 'DVD9') {\r\n                return AnimeStates.RESOLUTION;\r\n            } else {\r\n                return AnimeStates.VIDEO_CODEC;\r\n            }\r\n        },\r\n        [AnimeStates.VIDEO_CODEC]: newCaptureHandler('codec', AnimeStates.RESOLUTION),\r\n        [AnimeStates.RESOLUTION]: newCaptureHandler('resolution', AnimeStates.AUDIO_CODEC_AND_CHANNELS),\r\n        [AnimeStates.AUDIO_CODEC_AND_CHANNELS]: function AUDIO_CODEC() {\r\n            let field = this.getNext();\r\n            let codec = field.substr(0, field.lastIndexOf(' '));\r\n            let channels = field.substr(field.lastIndexOf(' ')+1);\r\n            if (channels.charAt(1) !== '.')\r\n                return GlobalStates.ERROR;\r\n            this.appendDelim();\r\n            this.appendSpan(codec, 'audioCodec', codec);\r\n            this.appendText(' ');\r\n            this.appendSpan(channels, 'audioChannels', channels);\r\n\r\n            return AnimeStates.DUAL_AUDIO;\r\n        },\r\n        [AnimeStates.DUAL_AUDIO]: newFlagHandler('Dual Audio', 'dualAudio', AnimeStates.REMASTER),\r\n        [AnimeStates.REMASTER]: function REMASTER() {\r\n            let node = this.peekNext();\r\n            if (node.tagName === 'IMG'\r\n            && node.alt === 'Remastered') {\r\n                this.index++;\r\n                this.appendDelim();\r\n                this.appendSpan(node, 'remastered', '');\r\n\r\n            }\r\n            return AnimeStates.SUBBING_AND_GROUP;\r\n        },\r\n        [AnimeStates.SUBBING_AND_GROUP]: function SUBBING() {\r\n            if (simpleSubbingHandler.call(this)) {\r\n                return GlobalStates.COMMON_TRAILING_FIELDS;\r\n            } else {\r\n                let field = this.getNext();\r\n                if (field.nodeType)\r\n                    return;\r\n                field = field.trim();\r\n                let left = field.substr(0, field.indexOf(' '));\r\n                if (left === 'Softsubs' || left === 'Hardsubs' || left === 'RAW') {\r\n                    this.appendDelim();\r\n                    this.appendSpan(left, 'subbing', left);\r\n                    this.appendText(' (');\r\n                    let groupString = field.substr(field.indexOf(' (')+2);\r\n                    while (!groupString.endsWith(')') && this.index < this.fields.length) {\r\n                        groupString += this.delim;\r\n                        groupString += this.getNext();\r\n                    }\r\n                    groupString = groupString.substr(0, groupString.length-1);\r\n                    this.appendSpan(groupString, 'group', groupString);\r\n                    this.appendText(')');\r\n\r\n                }\r\n            }\r\n            return GlobalStates.COMMON_TRAILING_FIELDS;\r\n        }\r\n    });\r\n\r\n    let simpleSubbingHandler = newListHandler(['Softsubs', 'Hardsubs', 'RAW'], 'subbing', true, false);\r\n\r\n    const GameStates = {\r\n        TYPE: 1,\r\n        PLATFORM: 2,\r\n        REGION: 3,\r\n        ARCHIVED: 4,\r\n        SCENE: 5\r\n    };\r\n\r\n    let GameHandlers = ({\r\n        [GlobalStates.BEGIN]: newCaptureHandler('type', GameStates.PLATFORM, false),\r\n        [GameStates.PLATFORM]: newCaptureHandler('platform', GameStates.REGION),\r\n        [GameStates.REGION]: newListHandler(\r\n            [\"Region Free\", \"NTSC-J\", \"NTSC-U\", \"PAL\", \"JPN\", \"ENG\", \"EUR\"],\r\n            'region', GameStates.ARCHIVED),\r\n        [GameStates.ARCHIVED]: newListHandler(\r\n            ['Archived', 'Unarchived'], 'archived', GameStates.SCENE),\r\n        [GameStates.SCENE]: newFlagHandler('Scene', 'scene', GlobalStates.COMMON_TRAILING_FIELDS),\r\n    });\r\n\r\n    const BookStates = Object.freeze({\r\n        TRANSLATION: 1,\r\n        FORMAT: 2,\r\n        ONGOING: 4,\r\n    });\r\n\r\n    let BookHandlers = {\r\n        [GlobalStates.BEGIN]: function() {\r\n            let field = this.getNext();\r\n            if (field.indexOf('  (') !== -1) {\r\n                let translation = field.substr(0, field.indexOf('  ('));\r\n                let group = field.slice(field.indexOf('  (')+3,\r\n                    -1);\r\n                this.appendSpan(translation, 'translation', translation);\r\n                this.appendText(' (');\r\n                this.appendSpan(group, 'group', group);\r\n                this.appendText(')');\r\n\r\n            } else {\r\n                let translation = field.replace(' ', '');\r\n                this.appendSpan(translation, 'translation', translation);\r\n            }\r\n            return BookStates.FORMAT;\r\n        },\r\n        [BookStates.FORMAT]: newListHandler(['Archived Scans', 'EPUB', 'PDF', 'Unarchived', 'Digital'], 'format', BookStates.ONGOING),\r\n        [BookStates.ONGOING]: newFlagHandler('Ongoing', 'ongoing', GlobalStates.COMMON_TRAILING_FIELDS),\r\n\r\n    };\r\n\r\n    let FirstFields = ({\r\n        \"Blu-ray\":AnimeHandlers,\"Web\":AnimeHandlers,\"TV\":AnimeHandlers,\r\n        \"DVD\":AnimeHandlers,\"UHD Blu-ray\":AnimeHandlers,\"DVD5\":AnimeHandlers,\r\n        \"DVD9\":AnimeHandlers,\"HD DVD\":AnimeHandlers,\"VHS\":AnimeHandlers,\r\n        \"VCD\":AnimeHandlers,\"LD\":AnimeHandlers,\r\n\r\n        \"MP3\":MusicHandlers,\"FLAC\":MusicHandlers,\"AAC\":MusicHandlers,\r\n\r\n        \"Game\":GameHandlers,\"Patch\":GameHandlers,\"DLC\":GameHandlers,\r\n\r\n        \"Raw\":BookHandlers,\"Translated\":BookHandlers,\r\n    });\r\n\r\n    let GlobalHandlers = ({\r\n        [GlobalStates.INITIALISE]: function INITIALISE() {\r\n            this.oldNodes = this.linkElement.childNodes;\r\n            for (let i = 0; i < this.oldNodes.length; i++) {\r\n                let child = this.oldNodes[i];\r\n                if (child.nodeType === Node.TEXT_NODE) {\r\n                    _debug() && console.log('Handling text node: x' + child.nodeValue + 'x');\r\n                    if (child.nodeValue.indexOf(this.delim) !== -1) {\r\n                        let str = child.nodeValue;\r\n                        if (i === 0) {\r\n                            if (str.charAt(0) === '»') {\r\n                                str = str.replace('»', '');\r\n                                this.appendText('» ');\r\n                            }\r\n                            str = str.replace(/^\\s+/, '');\r\n                        }\r\n                        let splitArray = str.split(this.delim);\r\n                        for (let j = 0; j < splitArray.length; j++) {\r\n                            if (splitArray[j])\r\n                                this.fields.push(splitArray[j]);\r\n                        }\r\n                    } else {\r\n                        this.fields.push(child.nodeValue.trim());\r\n                    }\r\n                } else {\r\n                    this.fields.push(child);\r\n                }\r\n            }\r\n\r\n            if (this.linkElement.childElementCount === 0) {\r\n                this.fields[this.fields.length-1] = this.fields[this.fields.length-1].replace(/\\s+$/, '');\r\n            }\r\n\r\n            let lastText = this.fields[this.fields.length-1];\r\n            _debug() && console.log('lastText: '+lastText);\r\n            if (typeof lastText === 'string' && lastText.endsWith(' - Snatched')) {\r\n\r\n                this.fields[this.fields.length-1] =\r\n                    lastText.substr(0, lastText.length-11);\r\n                this.fields.push(' - Snatched');\r\n                _debug() && console.log(this.fields);\r\n            }\r\n            return GlobalStates.DETECTING;\r\n        },\r\n        [GlobalStates.DETECTING]: function DETECTING() {\r\n            let f = this.peekNext();\r\n            _debug() && console.log('detecting: x'+f+'x');\r\n            let handler = FirstFields[f];\r\n            if (handler !== undefined)\r\n                this.handlers = handler;\r\n            else {\r\n                let left = f.substr(0, f.indexOf(' '));\r\n                this.handlers = FirstFields[left];\r\n                if (this.handlers === undefined) {\r\n                    this.handlers = {};\r\n                    console.info('No first field match for: x' + f+'x');\r\n                    return GlobalStates.ERROR;\r\n                }\r\n            }\r\n            return GlobalStates.BEGIN;\r\n        },\r\n        [GlobalStates.ERROR]: function ERROR() {\r\n            _debug() && console.log('error state');\r\n            if (this.nodeAppended) {\r\n                this.clearChildren();\r\n                for (let n = 0; n < this.oldNodes.length; n++) {\r\n                    this.linkElement.appendChild(\r\n                        this.oldNodes[n]\r\n                    );\r\n                }\r\n            }\r\n            return GlobalStates.FINISHED;\r\n        },\r\n        [GlobalStates.COMMON_TRAILING_FIELDS]: function COMMON_TRAILING() {\r\n            let node = this.peekNext();\r\n            _debug() && console.log('trailing fields');\r\n            _debug() && console.log(node);\r\n            if (!node) return GlobalStates.INSERT_DOCFRAG;\r\n            switch (node.nodeType) {\r\n            case Node.ELEMENT_NODE:\r\n                _debug() && console.log(node);\r\n                this.appendDelim();\r\n                this.index++;\r\n                switch (node.tagName.toUpperCase()) {\r\n                case 'IMG':\r\n                    if (node.alt === 'Freeleech!') {\r\n                        this.appendSpan(node, 'freeleech', '');\r\n                    } else {\r\n                        switch (node.src.substr(node.src.lastIndexOf('/')+1)) {\r\n                        case 'hentaic.png':\r\n                            this.appendSpan(node, 'hentai', 'Censored');\r\n                            break;\r\n                        case 'hentai.png':\r\n                            this.appendSpan(node, 'hentai', 'Uncensored');\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'FONT':\r\n                    if (node.textContent === 'Exclusive!') {\r\n                        this.appendSpan(node, 'exclusive', '');\r\n                    }\r\n                    break;\r\n                default:\r\n                    this.appendSpan(node, 'misc', node.textContent || '');\r\n                }\r\n                return GlobalStates.COMMON_TRAILING_FIELDS;\r\n                break;\r\n            default:\r\n                this.index++;\r\n                if (node.indexOf('- Snatched') !== -1) {\r\n                    this.appendText(' - ');\r\n                    this.appendSpan('Snatched', 'snatched', '');\r\n                } else {\r\n                    _debug() && console.log(this.fields);\r\n                    this.appendDelim();\r\n                    this.appendSpan(node, 'misc', node);\r\n                }\r\n                return GlobalStates.COMMON_TRAILING_FIELDS;\r\n                break;\r\n            }\r\n        },\r\n        [GlobalStates.INSERT_DOCFRAG]: function INSERT_DOCFRAG() {\r\n            _debug() && console.log('appending');\r\n            this.clearChildren();\r\n            this.linkElement.appendChild(this.docFrag);\r\n            return GlobalStates.FINISHED;\r\n        }\r\n    });\r\n\r\n    const torrentPageTorrents = document.querySelectorAll(\r\n        '.group_torrent>td>a[href*=\"&torrentid=\"]'\r\n    );\r\n    let p = new TorrentPropertyParser();\r\n    for (let t = 0; t < torrentPageTorrents.length; t++) {\r\n        let link = torrentPageTorrents[t];\r\n        let text = link.firstChild.textContent.trimLeft();\r\n        let hasArrow = text[0] === '»';\r\n        let prefix = '';\r\n        if (hasArrow) {\r\n            text = text.replace('»','').trimLeft();\r\n            prefix = '» ';\r\n        }\r\n        // console.log(text);\r\n        //const parsed = (parser.parse(text));\r\n\r\n        link.classList.add('userscript-highlight');\r\n        link.classList.add('torrent-page');\r\n\r\n        // link.firstChild.textContent = '';\r\n        // link.insertBefore(parsed, link.firstChild);\r\n\r\n        p.linkElement = link;\r\n        p.delim = link.href.indexOf('torrents.php') !== -1?' | ':' / ';\r\n        p.parse();\r\n\r\n    }\r\n\r\n    const searchResultTorrents = document.querySelectorAll(\r\n        '.torrent_properties>a[href*=\"&torrentid=\"]'\r\n    );\r\n    for (let t = 0; t < searchResultTorrents.length; t++) {\r\n        searchResultTorrents[t].className += 'userscript-highlight torrent-page';\r\n        p.linkElement = searchResultTorrents[t];\r\n        p.delim = ' | ';\r\n        p.parse();\r\n    }\r\n\r\n    const bbcodeTorrents = document.querySelectorAll(\r\n        ':not(.group_torrent)>:not(.torrent_properties)>a[href*=\"&torrentid=\"]:not([title])'\r\n    );\r\n    for (let t = 0; t < bbcodeTorrents.length; t++) {\r\n        let linkElement = bbcodeTorrents[t];\r\n        linkElement.classList.add('userscript-highlight');\r\n        linkElement.classList.add('torrent-bbcode');\r\n        let textNode = linkElement.firstChild;\r\n        let torrents1 = linkElement.href.indexOf('torrents.php') !== -1;\r\n        p.linkElement = linkElement;\r\n        p.delim =torrents1 ? ' | ':' / ';\r\n\r\n        let bbcodeString = textNode.nodeValue.trim();\r\n        let yearIndex = bbcodeString.indexOf('\\xa0\\xa0[');\r\n        let leftDocFrag = document.createDocumentFragment();\r\n        _debug() && console.log('yearIndex: ' + yearIndex);\r\n        if (yearIndex === -1) continue;\r\n        else {\r\n            let leftString = bbcodeString.substr(0, yearIndex);\r\n            let year = bbcodeString.substr(yearIndex+3, 4);\r\n            let dashIndex = torrents1 ? leftString.lastIndexOf(' - ') : leftString.indexOf(' - ');\r\n            let artist = leftString.substr(0, dashIndex);\r\n            let album = leftString.substr(dashIndex+3);\r\n\r\n            leftDocFrag.appendChild(\r\n                p.newSpan(artist, torrents1?'title':'artist', artist));\r\n            leftDocFrag.appendChild(\r\n                document.createTextNode(' - '));\r\n            leftDocFrag.appendChild(\r\n                p.newSpan(album, torrents1?'type':'album', album));\r\n            leftDocFrag.appendChild(document.createTextNode('\\xa0\\xa0['));\r\n            leftDocFrag.appendChild(p.newSpan(year, 'year', year));\r\n            leftDocFrag.appendChild(document.createTextNode('] ['));\r\n            if (bbcodeString.charAt(bbcodeString.length-1) === ']') {\r\n                textNode.nodeValue = bbcodeString.substr(0, bbcodeString.length-1);\r\n            } else {\r\n                textNode.nodeValue = bbcodeString + ' ';\r\n                linkElement.removeChild(linkElement.lastChild);\r\n            }\r\n            textNode.splitText(leftString.length+10);\r\n            linkElement.removeChild(textNode);\r\n        }\r\n        p.parse();\r\n        linkElement.insertBefore(\r\n            leftDocFrag,\r\n            linkElement.firstChild\r\n        );\r\n        if (yearIndex !== -1)\r\n            linkElement.appendChild(document.createTextNode(']'));\r\n\r\n    }\r\n})();"],"sourceRoot":""}